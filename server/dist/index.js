"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("reflect-metadata");
var inversify_express_utils_1 = require("inversify-express-utils");
var inversify_1 = require("inversify");
var bodyParser = require("body-parser");
var app_info_service_1 = require("./services/app-info.service");
var server_types_1 = require("./server.types");
var socket_service_1 = require("./socket/socket-service");
// import {ValveControllerService} from "./pour/valve-controller-service";
var pub_sub_service_1 = require("./universal/pub-sub.service");
var constants_1 = require("./constant/constants");
var app_data_service_1 = require("./services/app-data.service");
var app_productdata_service_1 = require("./services/app-productdata.service");
// import {PourControllerService} from "./pour/pour-controller-service";
// import {FunctionDriver} from "./pour/function-driver";
var configuration_controller_1 = require("./configuration/configuration-controller");
var configuration_service_1 = require("./configuration/configuration-service");
var product_data_service_1 = require("./configuration/product-data-service");
var configuration_repository_1 = require("./configuration/configuration-repository");
var product_data_repository_1 = require("./configuration/product-data-repository");
var valve_assignment_repository_1 = require("./configuration/valve-assignment-repository");
var device_info_1 = require("./unitstate/device-info");
// import Kernel from "inversify/dts/kernel/kernel";
// import {AppInfoService} from "./services/app-info";
// import TYPES from "./server.types";
// import * as bodyParser from "body-parser";
// prepare the ioc container
var kernel = new inversify_1.Kernel();
global["kernel"] = kernel;
var path = require('path'), fs = require('fs');
// service definitions
kernel.bind(server_types_1.default.AppInfo).to(app_info_service_1.AppInfoService).inSingletonScope();
kernel.bind(server_types_1.default.SocketService).to(socket_service_1.SocketService).inSingletonScope();
kernel.bind(server_types_1.default.DeviceInfo).to(device_info_1.DeviceInfo).inSingletonScope();
kernel.bind(server_types_1.default.AppDataService).to(app_data_service_1.AppDataService).inSingletonScope();
kernel.bind(server_types_1.default.AppProductdataService).to(app_productdata_service_1.AppProductdataService).inSingletonScope();
kernel.bind(inversify_express_utils_1.TYPE.Controller).to(configuration_controller_1.ConfigurationController).inSingletonScope()
    .whenTargetNamed(constants_1.TAGS.ConfigurationController);
kernel.bind(server_types_1.default.PubSubService).to(pub_sub_service_1.PubSubService).inSingletonScope();
kernel.bind(server_types_1.default.ConfigurationService).to(configuration_service_1.ConfigurationService).inSingletonScope();
kernel.bind(server_types_1.default.ConfigurationRepository).to(configuration_repository_1.ConfigurationRepository).inSingletonScope();
kernel.bind(server_types_1.default.ProductDataService).to(product_data_service_1.ProductDataService).inSingletonScope();
kernel.bind(server_types_1.default.ProductDataRepository).to(product_data_repository_1.ProductDataRepository).inSingletonScope();
kernel.bind(server_types_1.default.ValveAssignmentRepository).to(valve_assignment_repository_1.ValveAssignmentRepository).inSingletonScope();
kernel.bind(server_types_1.default.FileLocations).to(server_types_1.FileLocations).inSingletonScope();
// kernel.bind<interfaces.Controller>(TYPES.PourControllerService)
// .to(PourControllerService).inSingletonScope().whenTargetNamed(TAGS.PourControllerService);
// kernel.bind<FunctionDriver>(TYPES.FunctionDriver).to(FunctionDriver).inSingletonScope().whenTargetNamed(TAGS.FunctionDriver);
// kernel.bind<ValveControllerService>(TYPES.ValveControllerService).to(ValveControllerService).inSingletonScope();
// CORS middleware
var allowCrossDomain = function (req, res, next) {
    res.header('Access-Control-Allow-Origin', '*');
    res.header('Access-Control-Allow-Methods', 'GET,PUT,POST,DELETE');
    res.header('Access-Control-Allow-Headers', 'Content-Type');
    next();
};
// start the server
var server = new inversify_express_utils_1.InversifyExpressServer(kernel);
server.setConfig(function (app) {
    app.use(bodyParser.json());
    app.use(allowCrossDomain);
});
var app = server.build();
app.use(bodyParser.urlencoded({
    extended: true
}));
device_info_1.DeviceInfo.initialize();
var appInfo = kernel.get(server_types_1.default.AppInfo);
app.listen(appInfo.config.serverPort);
console.log("API Server started on port " + appInfo.config.serverPort + " :)");
// fire up the common services
kernel.get(server_types_1.default.SocketService);
// kernel.get(TYPES.ValveControllerService) ;
// kernel.get(TYPES.PourControllerService) ;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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Q0FBQyxDQUFDO0FBQ3RDLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0NBQThCLE9BQU8sQ0FBQyxNQUFNLENBQUMsVUFBVSxRQUFLLENBQUMsQ0FBQztBQUUxRSw4QkFBOEI7QUFDOUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxzQkFBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ2hDLDZDQUE2QztBQUM3Qyw0Q0FBNEMiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xuaW1wb3J0IHsgaW50ZXJmYWNlcywgSW52ZXJzaWZ5RXhwcmVzc1NlcnZlciwgVFlQRSB9IGZyb20gJ2ludmVyc2lmeS1leHByZXNzLXV0aWxzJztcbmltcG9ydCB7IEtlcm5lbCAgfSBmcm9tICdpbnZlcnNpZnknO1xuaW1wb3J0ICogYXMgYm9keVBhcnNlciBmcm9tICdib2R5LXBhcnNlcic7XG5pbXBvcnQge0FwcEluZm9TZXJ2aWNlfSBmcm9tIFwiLi9zZXJ2aWNlcy9hcHAtaW5mby5zZXJ2aWNlXCI7XG5pbXBvcnQge0lUYXNrfSBmcm9tIFwiLi90YXNrcy90YXNrLXJ1bm5lclwiO1xuXG5pbXBvcnQgKiBhcyBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0ICogYXMgaHR0cCBmcm9tIFwiaHR0cFwiO1xuaW1wb3J0ICogYXMgc29ja2V0SW8gZnJvbSBcInNvY2tldC5pb1wiO1xuaW1wb3J0ICogYXMgY29ycyBmcm9tIFwiY29yc1wiO1xuaW1wb3J0IHsgRGV2aWNlRGVzY3JpcHRvciB9IGZyb20gJy4vdW5pdmVyc2FsL2FwcC50eXBlcyc7XG5pbXBvcnQgVFlQRVMsIHtGaWxlTG9jYXRpb25zfSBmcm9tIFwiLi9zZXJ2ZXIudHlwZXNcIjtcbmltcG9ydCB7U29ja2V0U2VydmljZX0gZnJvbSBcIi4vc29ja2V0L3NvY2tldC1zZXJ2aWNlXCI7XG4vLyBpbXBvcnQge1ZhbHZlQ29udHJvbGxlclNlcnZpY2V9IGZyb20gXCIuL3BvdXIvdmFsdmUtY29udHJvbGxlci1zZXJ2aWNlXCI7XG5pbXBvcnQge1B1YlN1YlNlcnZpY2V9IGZyb20gXCIuL3VuaXZlcnNhbC9wdWItc3ViLnNlcnZpY2VcIjtcbmltcG9ydCB7VEFHU30gZnJvbSBcIi4vY29uc3RhbnQvY29uc3RhbnRzXCI7XG5pbXBvcnQge0FwcERhdGFTZXJ2aWNlfSBmcm9tIFwiLi9zZXJ2aWNlcy9hcHAtZGF0YS5zZXJ2aWNlXCI7XG5pbXBvcnQge0FwcFByb2R1Y3RkYXRhU2VydmljZX0gZnJvbSBcIi4vc2VydmljZXMvYXBwLXByb2R1Y3RkYXRhLnNlcnZpY2VcIjtcbi8vIGltcG9ydCB7UG91ckNvbnRyb2xsZXJTZXJ2aWNlfSBmcm9tIFwiLi9wb3VyL3BvdXItY29udHJvbGxlci1zZXJ2aWNlXCI7XG4vLyBpbXBvcnQge0Z1bmN0aW9uRHJpdmVyfSBmcm9tIFwiLi9wb3VyL2Z1bmN0aW9uLWRyaXZlclwiO1xuaW1wb3J0IHtDb25maWd1cmF0aW9uQ29udHJvbGxlcn0gZnJvbSBcIi4vY29uZmlndXJhdGlvbi9jb25maWd1cmF0aW9uLWNvbnRyb2xsZXJcIjtcbmltcG9ydCB7Q29uZmlndXJhdGlvblNlcnZpY2V9IGZyb20gXCIuL2NvbmZpZ3VyYXRpb24vY29uZmlndXJhdGlvbi1zZXJ2aWNlXCI7XG5pbXBvcnQge1Byb2R1Y3REYXRhU2VydmljZX0gZnJvbSBcIi4vY29uZmlndXJhdGlvbi9wcm9kdWN0LWRhdGEtc2VydmljZVwiO1xuaW1wb3J0IHtDb25maWd1cmF0aW9uUmVwb3NpdG9yeX0gZnJvbSBcIi4vY29uZmlndXJhdGlvbi9jb25maWd1cmF0aW9uLXJlcG9zaXRvcnlcIjtcbmltcG9ydCB7UHJvZHVjdERhdGFSZXBvc2l0b3J5fSBmcm9tIFwiLi9jb25maWd1cmF0aW9uL3Byb2R1Y3QtZGF0YS1yZXBvc2l0b3J5XCI7XG5pbXBvcnQge1ZhbHZlQXNzaWdubWVudFJlcG9zaXRvcnl9IGZyb20gXCIuL2NvbmZpZ3VyYXRpb24vdmFsdmUtYXNzaWdubWVudC1yZXBvc2l0b3J5XCI7XG5pbXBvcnQge0RldmljZUluZm99IGZyb20gXCIuL3VuaXRzdGF0ZS9kZXZpY2UtaW5mb1wiO1xuXG4vLyBpbXBvcnQgS2VybmVsIGZyb20gXCJpbnZlcnNpZnkvZHRzL2tlcm5lbC9rZXJuZWxcIjtcbi8vIGltcG9ydCB7QXBwSW5mb1NlcnZpY2V9IGZyb20gXCIuL3NlcnZpY2VzL2FwcC1pbmZvXCI7XG4vLyBpbXBvcnQgVFlQRVMgZnJvbSBcIi4vc2VydmVyLnR5cGVzXCI7XG4vLyBpbXBvcnQgKiBhcyBib2R5UGFyc2VyIGZyb20gXCJib2R5LXBhcnNlclwiO1xuXG4vLyBwcmVwYXJlIHRoZSBpb2MgY29udGFpbmVyXG5sZXQga2VybmVsID0gbmV3IEtlcm5lbCgpO1xuZ2xvYmFsW1wia2VybmVsXCJdID0ga2VybmVsIDtcblxudmFyIHBhdGggPSByZXF1aXJlKCdwYXRoJyksXG4gICAgZnMgPSByZXF1aXJlKCdmcycpO1xuXG4vLyBzZXJ2aWNlIGRlZmluaXRpb25zXG5rZXJuZWwuYmluZDxBcHBJbmZvU2VydmljZT4oVFlQRVMuQXBwSW5mbykudG8oQXBwSW5mb1NlcnZpY2UpLmluU2luZ2xldG9uU2NvcGUoKTtcbmtlcm5lbC5iaW5kPFNvY2tldFNlcnZpY2U+KFRZUEVTLlNvY2tldFNlcnZpY2UpLnRvKFNvY2tldFNlcnZpY2UpLmluU2luZ2xldG9uU2NvcGUoKTtcbmtlcm5lbC5iaW5kPERldmljZUluZm8+KFRZUEVTLkRldmljZUluZm8pLnRvKERldmljZUluZm8pLmluU2luZ2xldG9uU2NvcGUoKTtcbmtlcm5lbC5iaW5kPEFwcERhdGFTZXJ2aWNlPihUWVBFUy5BcHBEYXRhU2VydmljZSkudG8oQXBwRGF0YVNlcnZpY2UpLmluU2luZ2xldG9uU2NvcGUoKTtcbmtlcm5lbC5iaW5kPEFwcFByb2R1Y3RkYXRhU2VydmljZT4oVFlQRVMuQXBwUHJvZHVjdGRhdGFTZXJ2aWNlKS50byhBcHBQcm9kdWN0ZGF0YVNlcnZpY2UpLmluU2luZ2xldG9uU2NvcGUoKTtcbmtlcm5lbC5iaW5kPGludGVyZmFjZXMuQ29udHJvbGxlcj4oVFlQRS5Db250cm9sbGVyKS50byhDb25maWd1cmF0aW9uQ29udHJvbGxlcikuaW5TaW5nbGV0b25TY29wZSgpXG4gICAgLndoZW5UYXJnZXROYW1lZChUQUdTLkNvbmZpZ3VyYXRpb25Db250cm9sbGVyKTtcbmtlcm5lbC5iaW5kPFB1YlN1YlNlcnZpY2U+KFRZUEVTLlB1YlN1YlNlcnZpY2UpLnRvKFB1YlN1YlNlcnZpY2UpLmluU2luZ2xldG9uU2NvcGUoKTtcbmtlcm5lbC5iaW5kPENvbmZpZ3VyYXRpb25TZXJ2aWNlPihUWVBFUy5Db25maWd1cmF0aW9uU2VydmljZSkudG8oQ29uZmlndXJhdGlvblNlcnZpY2UpLmluU2luZ2xldG9uU2NvcGUoKTtcbmtlcm5lbC5iaW5kPENvbmZpZ3VyYXRpb25SZXBvc2l0b3J5PihUWVBFUy5Db25maWd1cmF0aW9uUmVwb3NpdG9yeSkudG8oQ29uZmlndXJhdGlvblJlcG9zaXRvcnkpLmluU2luZ2xldG9uU2NvcGUoKTtcbmtlcm5lbC5iaW5kPFByb2R1Y3REYXRhU2VydmljZT4oVFlQRVMuUHJvZHVjdERhdGFTZXJ2aWNlKS50byhQcm9kdWN0RGF0YVNlcnZpY2UpLmluU2luZ2xldG9uU2NvcGUoKTtcbmtlcm5lbC5iaW5kPFByb2R1Y3REYXRhUmVwb3NpdG9yeT4oVFlQRVMuUHJvZHVjdERhdGFSZXBvc2l0b3J5KS50byhQcm9kdWN0RGF0YVJlcG9zaXRvcnkpLmluU2luZ2xldG9uU2NvcGUoKTtcbmtlcm5lbC5iaW5kPFZhbHZlQXNzaWdubWVudFJlcG9zaXRvcnk+KFRZUEVTLlZhbHZlQXNzaWdubWVudFJlcG9zaXRvcnkpLnRvKFZhbHZlQXNzaWdubWVudFJlcG9zaXRvcnkpLmluU2luZ2xldG9uU2NvcGUoKTtcbmtlcm5lbC5iaW5kPEZpbGVMb2NhdGlvbnM+KFRZUEVTLkZpbGVMb2NhdGlvbnMpLnRvKEZpbGVMb2NhdGlvbnMpLmluU2luZ2xldG9uU2NvcGUoKTtcblxuLy8ga2VybmVsLmJpbmQ8aW50ZXJmYWNlcy5Db250cm9sbGVyPihUWVBFUy5Qb3VyQ29udHJvbGxlclNlcnZpY2UpXG4vLyAudG8oUG91ckNvbnRyb2xsZXJTZXJ2aWNlKS5pblNpbmdsZXRvblNjb3BlKCkud2hlblRhcmdldE5hbWVkKFRBR1MuUG91ckNvbnRyb2xsZXJTZXJ2aWNlKTtcbi8vIGtlcm5lbC5iaW5kPEZ1bmN0aW9uRHJpdmVyPihUWVBFUy5GdW5jdGlvbkRyaXZlcikudG8oRnVuY3Rpb25Ecml2ZXIpLmluU2luZ2xldG9uU2NvcGUoKS53aGVuVGFyZ2V0TmFtZWQoVEFHUy5GdW5jdGlvbkRyaXZlcik7XG4vLyBrZXJuZWwuYmluZDxWYWx2ZUNvbnRyb2xsZXJTZXJ2aWNlPihUWVBFUy5WYWx2ZUNvbnRyb2xsZXJTZXJ2aWNlKS50byhWYWx2ZUNvbnRyb2xsZXJTZXJ2aWNlKS5pblNpbmdsZXRvblNjb3BlKCk7XG5cbi8vIENPUlMgbWlkZGxld2FyZVxuY29uc3QgYWxsb3dDcm9zc0RvbWFpbiA9IGZ1bmN0aW9uKHJlcSwgcmVzLCBuZXh0KSB7XG4gICAgcmVzLmhlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgJyonKTtcbiAgICByZXMuaGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJywgJ0dFVCxQVVQsUE9TVCxERUxFVEUnKTtcbiAgICByZXMuaGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJywgJ0NvbnRlbnQtVHlwZScpO1xuXG4gICAgbmV4dCgpO1xufVxuXG4vLyBzdGFydCB0aGUgc2VydmVyXG5jb25zdCBzZXJ2ZXIgPSBuZXcgSW52ZXJzaWZ5RXhwcmVzc1NlcnZlcihrZXJuZWwpO1xuc2VydmVyLnNldENvbmZpZygoYXBwKSA9PiB7XG4gICAgYXBwLnVzZShib2R5UGFyc2VyLmpzb24oKSk7XG4gICAgYXBwLnVzZShhbGxvd0Nyb3NzRG9tYWluKSA7XG59KTtcblxubGV0IGFwcCA9IHNlcnZlci5idWlsZCgpO1xuXG5hcHAudXNlKGJvZHlQYXJzZXIudXJsZW5jb2RlZCh7XG4gICAgZXh0ZW5kZWQ6IHRydWVcbn0pKTtcblxuRGV2aWNlSW5mby5pbml0aWFsaXplKCk7XG5cbmNvbnN0IGFwcEluZm86IEFwcEluZm9TZXJ2aWNlID0gPEFwcEluZm9TZXJ2aWNlPiBrZXJuZWwuZ2V0KFRZUEVTLkFwcEluZm8pO1xuXG5hcHAubGlzdGVuKGFwcEluZm8uY29uZmlnLnNlcnZlclBvcnQpO1xuY29uc29sZS5sb2coYEFQSSBTZXJ2ZXIgc3RhcnRlZCBvbiBwb3J0ICR7YXBwSW5mby5jb25maWcuc2VydmVyUG9ydH0gOilgKTtcblxuLy8gZmlyZSB1cCB0aGUgY29tbW9uIHNlcnZpY2VzXG5rZXJuZWwuZ2V0KFRZUEVTLlNvY2tldFNlcnZpY2UpO1xuLy8ga2VybmVsLmdldChUWVBFUy5WYWx2ZUNvbnRyb2xsZXJTZXJ2aWNlKSA7XG4vLyBrZXJuZWwuZ2V0KFRZUEVTLlBvdXJDb250cm9sbGVyU2VydmljZSkgO1xuXG5cblxuIl19
