"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var server_types_1 = require("../server.types");
var JsUtil_1 = require("../universal/JsUtil");
var pub_sub_types_1 = require("../universal/pub-sub-types");
var DeviceInfo = /** @class */ (function () {
    function DeviceInfo() {
    }
    DeviceInfo.initialize = function () {
        DeviceInfo.objectId = JsUtil_1.JsUtil.getObjectId();
        console.log("ctor.DeviceInfo", DeviceInfo.objectId);
        DeviceInfo.configurationRepository = global["kernel"].get(server_types_1.default.ConfigurationRepository);
        DeviceInfo.unitState = DeviceInfo.configurationRepository.getUnitState();
        pub_sub_types_1.SubscribeEvent.Create(pub_sub_types_1.PubSubTopic.unitStateChange, DeviceInfo.objectId)
            .HandleEventWithThisMethod(function (e) { return DeviceInfo.handleUnitStateChanged(e); })
            .Done();
        //        DeviceInfo.unitState.suspendWrite = false;
    };
    DeviceInfo.handleUnitStateChanged = function (e) {
        console.log("Writing UnitState...");
        //        DeviceInfo.unitState.suspendWrite = false;
        DeviceInfo.configurationRepository.saveUnitState(DeviceInfo.unitState);
        //        DeviceInfo.unitState.suspendWrite = true;
    };
    return DeviceInfo;
}());
exports.DeviceInfo = DeviceInfo;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVuaXRzdGF0ZS9kZXZpY2UtaW5mby50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUdBLGdEQUFvQztBQUNwQyw4Q0FBMkM7QUFJM0MsNERBQXdGO0FBRXhGO0lBQUE7SUE2QkEsQ0FBQztJQXZCVSxxQkFBVSxHQUFqQjtRQUNJLFVBQVUsQ0FBQyxRQUFRLEdBQUcsZUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQzNDLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRXBELFVBQVUsQ0FBQyx1QkFBdUIsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLHNCQUFLLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUV6RixVQUFVLENBQUMsU0FBUyxHQUFHLFVBQVUsQ0FBQyx1QkFBdUIsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUV6RSw4QkFBYyxDQUFDLE1BQU0sQ0FBQywyQkFBVyxDQUFDLGVBQWUsRUFBRSxVQUFVLENBQUMsUUFBUSxDQUFDO2FBQ2xFLHlCQUF5QixDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsVUFBVSxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxFQUFwQyxDQUFvQyxDQUFDO2FBQ3BFLElBQUksRUFBRSxDQUFFO1FBRXJCLG9EQUFvRDtJQUNoRCxDQUFDO0lBRU0saUNBQXNCLEdBQTdCLFVBQThCLENBQWtCO1FBQzVDLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUU1QyxvREFBb0Q7UUFDNUMsVUFBVSxDQUFDLHVCQUF1QixDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDL0UsbURBQW1EO0lBQy9DLENBQUM7SUFFTCxpQkFBQztBQUFELENBN0JBLEFBNkJDLElBQUE7QUE3QlksZ0NBQVUiLCJmaWxlIjoidW5pdHN0YXRlL2RldmljZS1pbmZvLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQge2luamVjdCwgaW5qZWN0YWJsZX0gZnJvbSBcImludmVyc2lmeVwiO1xuaW1wb3J0IHtBcHBJbmZvU2VydmljZX0gZnJvbSBcIi4uL3NlcnZpY2VzL2FwcC1pbmZvLnNlcnZpY2VcIjtcbmltcG9ydCBUWVBFUyBmcm9tIFwiLi4vc2VydmVyLnR5cGVzXCI7XG5pbXBvcnQge0pzVXRpbH0gZnJvbSBcIi4uL3VuaXZlcnNhbC9Kc1V0aWxcIjtcbmltcG9ydCB7U2NyZWVuTWV0cmljc30gZnJvbSBcIi4uL3VuaXZlcnNhbC9hcHAudHlwZXNcIjtcbmltcG9ydCB7Q29uZmlndXJhdGlvblJlcG9zaXRvcnl9IGZyb20gXCIuLi9jb25maWd1cmF0aW9uL2NvbmZpZ3VyYXRpb24tcmVwb3NpdG9yeVwiO1xuaW1wb3J0IHtVbml0U3RhdGV9IGZyb20gXCIuL3VuaXQtc3RhdGVcIjtcbmltcG9ydCB7UHViU3ViRXZlbnRBcmdzLCBQdWJTdWJUb3BpYywgU3Vic2NyaWJlRXZlbnR9IGZyb20gXCIuLi91bml2ZXJzYWwvcHViLXN1Yi10eXBlc1wiO1xuXG5leHBvcnQgY2xhc3MgRGV2aWNlSW5mbyB7XG4gICAgc3RhdGljIG9iamVjdElkOiBudW1iZXI7XG4gICAgc3RhdGljIGNvbmZpZ3VyYXRpb25SZXBvc2l0b3J5OiBDb25maWd1cmF0aW9uUmVwb3NpdG9yeTtcblxuICAgIHN0YXRpYyB1bml0U3RhdGU6IFVuaXRTdGF0ZTtcblxuICAgIHN0YXRpYyBpbml0aWFsaXplKCkge1xuICAgICAgICBEZXZpY2VJbmZvLm9iamVjdElkID0gSnNVdGlsLmdldE9iamVjdElkKCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiY3Rvci5EZXZpY2VJbmZvXCIsIERldmljZUluZm8ub2JqZWN0SWQpO1xuXG4gICAgICAgIERldmljZUluZm8uY29uZmlndXJhdGlvblJlcG9zaXRvcnkgPSBnbG9iYWxbXCJrZXJuZWxcIl0uZ2V0KFRZUEVTLkNvbmZpZ3VyYXRpb25SZXBvc2l0b3J5KTtcblxuICAgICAgICBEZXZpY2VJbmZvLnVuaXRTdGF0ZSA9IERldmljZUluZm8uY29uZmlndXJhdGlvblJlcG9zaXRvcnkuZ2V0VW5pdFN0YXRlKCk7XG5cbiAgICAgICAgU3Vic2NyaWJlRXZlbnQuQ3JlYXRlKFB1YlN1YlRvcGljLnVuaXRTdGF0ZUNoYW5nZSwgRGV2aWNlSW5mby5vYmplY3RJZClcbiAgICAgICAgICAgIC5IYW5kbGVFdmVudFdpdGhUaGlzTWV0aG9kKGUgPT4gRGV2aWNlSW5mby5oYW5kbGVVbml0U3RhdGVDaGFuZ2VkKGUpKVxuICAgICAgICAgICAgLkRvbmUoKSA7XG5cbi8vICAgICAgICBEZXZpY2VJbmZvLnVuaXRTdGF0ZS5zdXNwZW5kV3JpdGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaGFuZGxlVW5pdFN0YXRlQ2hhbmdlZChlOiBQdWJTdWJFdmVudEFyZ3MpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJXcml0aW5nIFVuaXRTdGF0ZS4uLlwiKTtcblxuLy8gICAgICAgIERldmljZUluZm8udW5pdFN0YXRlLnN1c3BlbmRXcml0ZSA9IGZhbHNlO1xuICAgICAgICBEZXZpY2VJbmZvLmNvbmZpZ3VyYXRpb25SZXBvc2l0b3J5LnNhdmVVbml0U3RhdGUoRGV2aWNlSW5mby51bml0U3RhdGUpO1xuLy8gICAgICAgIERldmljZUluZm8udW5pdFN0YXRlLnN1c3BlbmRXcml0ZSA9IHRydWU7XG4gICAgfVxuXG59XG4iXX0=
